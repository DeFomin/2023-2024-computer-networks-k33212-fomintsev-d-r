## Практическая работа № 6.
## Оглавление
- [Трансляция адресов (NAT) в Cisco Packet Tracer.](#section1)
  - [Цель работы](#section1.1)  
  - [Краткие теоретические сведения](#section1.2)
  - [Требования](#section1.3)
- [Ход работы](#section1.4)
  - [Построение схемы, субинтерфейсы, dhcp-сервер](#section1.5)
  - [PAT](#section1.6)
  - [NAT](#section1.7)
- [Вывод](#section2)


## <a name="section1">Трансляция адресов (NAT) в Cisco Packet Tracer.</a>

## <a name="section1.1">Цель работы</a>

Закрепить понимание принципов работы NAT, а также сформировать начальные навыки в конфигурировании NAT и Firewall в Cisco Packet Tracer. 

## <a name="section1.2">Краткие теоретическме сведения</a>  

NAT (Network Address Translation) – технология стека TCP\IP. Она позволяет модифицировать заголовки пересылаемых через NAT IP-пакетов и TCP\UDP сообщений.  

NAT в общем случае представляет собой компьютер или аппаратный маршрутизатор, подключенный одним интерфейсом к внешней сети, а другими к внутренней. Оба интерфейса имеют IP адреса в каждой из сетей. Типичным применением NAT является обеспечение доступа из локальной сети с приватными IP-адресами к ресурсам внешней сети с IP-адресами интернет. При передаче запроса от локального клиента к внешнему ресурсу подменяется сокет отправителя: IP адрес меняется на внешний IP адрес NAT, а порт на свободный порт на внешнем интерфейсе NAT. Когда приходит ответ от внешнего ресурса, происходит обратная замена сокета и пакет передается в локальную сеть получателю. Так же с помощью NAT можно публиковать локальные сокеты на реальном IP адресе и реальном порту. Например, для обеспечения доступа извне к Web серверу, расположенному в локальной сети. В этом случае на NAT делается статическое отображение внешнего сокета на внутренний.
 Публичный IP адрес (Белый IP) - адрес-это глобально маршрутизируемый одноадресный IP-адрес, что означает, что этот адрес не является адресом, зарезервированным для использования в частных сетях, таких как сети, зарезервированные RFC 1918, или различные форматы адресов IPv6 локальной области или локальной области сайта, например для локальной адресации канала
Частный IP адрес (Серый IP)  -  
    • От 10.0.0.0 до 10.255.255.255 с маской 255.0.0.0.0 (сеть класса А - около 16 млн. адресов)  
    • От 172.16.0.0 до 172.31.255.255 с маской 255.240.0.0 (сеть класса B - около 65 тыс. адресов)   
    • От 192.168.0.0 до 192.168.255.255 с маской 255.255.255.0 (сеть класса С - около 256 адресов)  

**Определение:** Субинтерфейс представляет собой виртуальный интерфейс, созданный на основе физического сетевого интерфейса. Это позволяет использовать один физический интерфейс для передачи данных между несколькими логическими (виртуальными) сетями.  
Использование: Субинтерфейсы часто используются в сетях с технологией VLAN (Virtual Local Area Network), где различные виртуальные сети могут существовать на одном физическом кабеле.  

## <a name="section1.3">Требования</a>

для выполнения работы необходима установка симулятора CISCO PacketTracer.

## <a name="section1.4">Ход работы</a>

## <a name="section1.5">Построение схемы, субинтерфейсы, dhcp-сервер</a>

Изменения, внесенные в нашу сеть:  
  * Маршрутизатор, который маршрутизирует  трафик из существующей сети наружу  
  * Сервер, эмулирующий сервер в сети Интернет  
  * Маршрутизатор, который эмулирует провайдера
  * Удаленный коммутатор 3 уровня, поскольку он не нужен, ведь теперь трафик может маршрутизироваться маршрутизатором. В таком случае VLAN’ы будут приземляться на машртутизаторе, поэтому порт коммутатора L2, который подсоединяется к маршрутизатору, будет trunk.

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/b3e9afac-3938-438b-b9df-4a3d08216367" width=900></p>

Все существующие VLAN в базу данных маршрутизатора сети, так как раньше они были на коммутаторе L3. Затем необходимо было создать субинтерфейсы для каждого из VLAN, и назначить на каждый из них IP-адрес.

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/20da8d35-c082-419b-ac64-2a5201c560ea" width=700></p>

Пример для VLAN-10:
```
Router# vlan database
Router# vlan 10 name VLAN-10

Router(config)# ip dhcp pool VLAN-10
Router(dhcp-config)# network 10.10.0.0 255.255.255.0
Router(dhcp-config)# default-router 10.10.0.254
Router(dhcp-config)# exit
Router(config)# interface FastEthernet0/0.10
Router(config-subif)# encapsulation dot1Q 10
Router(config-subif)# ip address 10.10.0.254 255.255.255.0
Router(config-subif)# ip helper-address 10.10.0.254
Router(config-subif)# exit
Router(config)# end
Router# write memory
```

Теперь сервер больше не выступает в качестве DHCP-сервера, необходимо настроить его на маршрутизаторе. Для каждого VLAN был создан свой набор IP-адресов

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/c2edff01-cefa-49b7-9f13-5628facaa4dd" width=700></p>

Просмотреть информацию о DHCP:

```
Router# show ip dhcp pool
```

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/3c4f80f9-06ee-41fe-bb3c-1e85e40a37f6" width=700></p>


Теперь у нас обновленная сеть с маршрутизатором, с рабочим dhcp-сервером


## <a name="section1.6">PAT</a>

PAT (Port Address Translation) является одним из вариантов NAT (Network Address Translation). PAT также называют "NAT overload" или "NAT с перегрузкой". Он представляет собой расширение обычного NAT, которое позволяет множеству устройств в локальной сети использовать один и тот же глобальный IP-адрес, но каждый из них будет отличаться по порту.

После необходимо было настроить IP-адреса на портах двух добавленных маршрутизаторов. На маршрутизаторе, который связан с локальной сетью, были выполнены следующие команды для настройки PAT

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/ca404afa-8ab9-41e6-aaa7-dd23f58a8062" width=700></p>

Необходимо учесть, что внутренних интерфейсов несколько, по количеству VLAN, но доступ в Интернет нужен только компьютерам, ноутбукам и серверу.

На интерфейсе Fa0/1 был настроен белый IP-адрес и узел по умолчанию:

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/f5f0ba89-e7d7-4384-b2ce-f37b2a7f2d14" width=700></p>

Далее на первом маршрутизаторе был создан access-list, который определяет какой трафик должны пропускать через NAT

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/5f05a992-99de-4768-80c9-63bbfdebaa5b" width=700></p>

Также access-list был применен для интерфейса Fa0/0

```ip nat inside source list NAT int fa0/0 overload```

На втором маршрутизаторе настройка адресов интерфейсов:

```
int fa0/1
ip address 81.81.81.253 255.255.255.252

int fa0/0
ip address 82.82.82.253 255.255.255.252
```

* Настройка сервера

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/c921d275-0922-49ec-ae45-1fc49f87cf26" width=700></p>

## <a name="section1.7">NAT</a>

* Схема

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/0eb89ef7-fc4d-4077-9430-52ca8ea4657a" width=700></p>

Для того, чтобы локальный сервер был доступен из-вне, необходимо настроить проброс портов с помощью следующей команды:
```ip nat inside source static tcp 10.60.0.1 80 81.81.81.254 80```

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/712437d5-d0e8-4108-8dbc-77717e201609" width=700></p>


<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/7a09bce0-86a8-4d4a-ae7a-e0a5a2a043f1" width=700></p>

```show ip nat translations```

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/3cae31f5-7127-422b-8764-01901b1450fb" width=700></p>

## <a name="section2">Вывод</a>

В ходе выполнения лабораторной работы было закреплено понимание принципов работы NAT, а также сформированы начальные навыки в конфигурировании NAT в Cisco Packet Tracer.













