## Практическая работа № 5.
## Оглавление
- [Изучение работы протоколов стека TCP/IP с помощью Wireshark.](#section1)
  - [Цель работы](#section1.1)  
  - [Краткие теоретические сведения](#section1.2)
  - [Требования](#section1.3)
- [Ход работы](#section1.4)
  - [Начало работы с Wireshark](#section1.5)
  - [Сбор и анализ данных протокола ICMP](#section1.6)
  - [Анализ полей TCP](#section1.7)
  - [](#section1.8)
- [Вывод](#section2)


## <a name="section1">Изучение работы протоколов стека TCP/IP с помощью Wireshark.</a>

## <a name="section1.1">Цель работы</a>

Разобраться со стеком TCP/IP, анализируя пакеты, которые отправляются и принимаются с помощью данного стека. Научиться собирать сетевой трафик с помощью программы Wireshark. Научиться фильтровать собранный трафик, находить и просматривать соединения. 

## <a name="section1.2">Краткие теоретическме сведения</a>  

Wireshark – это программный инструмент для перехвата и анализа сетевого трафика. Сама программа, в первую очередь, предназначена для сбора информации о сетевых взаимодействиях и для обнаружения и устранения неполадок в сети. Анализаторы трафика применяются при разработке новых протоколов и программного обеспечения. Установленная и запущенная на компьютере программа Wireshark позволяет обнаружить и изучить любой протокольный блок данных (Protocol Data Unit, PDU), который был отправлен и получен с помощью установленных на компьютере сетевых адаптеров (Network Interface Card, NIC). По мере движения потоков данных по сети анализатор перехватывает каждый протокольный блок данных (PDU), после чего расшифровывает или анализирует его содержание согласно соответствующему документу RFC или другим спецификациям.


## <a name="section1.3">Требования</a>

Для выполнения работы необходима установка программы Wireshark. 

## <a name="section1.4">Ход работы</a>

## <a name="section1.5">Начало работы с Wireshark</a>
* Настройка перехвата трафика

1. Для того, чтобы настроить перехват трафика на интерфейсе так, чтобы он завершился после сбора 5 Мб, необходимо на панели нажать "Capture", перейти в "Options" и во вкладке "Options" в разделе "Stop capture automatically after" указать 5mb. После захвата 5mb произойдет автоматическое завершение перехвата трафика.  

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/02cef62c-7e86-4e9a-aee6-edeeff66dcca" width=600></p>

*  Инструментарий статистики
1. Для определения узла с максимальной активностью по объему переданных данных переходим в "Statistics", "Endpoints", выбираем нужный протокол и сортируем по "Tx Bytes"

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/e771db9d-db66-4aa1-9f8f-ef94d18d133c" width=600></p>

В данном случае это узел с ip адресом 2.16.21.35

2. Для определения узела, осуществившего наибольшее количество широковещательных рассылок используем поиск по фильтру ```eth.dst == ff:ff:ff:ff:ff:ff``` далее с помощью окна «Endpoints», с включенной опцией «Limit to display filter» и сортировкой по "Tx Bytes" смотрим результаты

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/ab156f8a-bfd1-45bb-8766-490abf393ac8" width=600></p>

В данном случае это штроковещательный адресс 192.168.3.70

3. Для определения самого активного TCP-порта на хосте (по количеству переданных пакетов) используем поиск по фильтру адреса отправителя ```ip.src == 192.168.3.58```, в статистике выбираем протокол tcp, также ставим галочку лимита поиска по фильтру, фильтрацию по столбцу "Transmitted Packets" и смотрим результат.

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/3a205540-8d8b-47a5-84d5-db6500c0b21b" width=600></p>

В данном случае самый активный tcp порт: 48934.

4. Чтобы на одной координатной сетке построить графики интенсивности TCP и UDP трафика (пункт Io Graphs) необходимо на панели в разделе "Statistics" открыть окно "I/O Graphs". Там в качестве графиков необходимо добавить два источника данных: первый с "Display Filter" равный "tcp", второй с "Display Filter" равный "udp"

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/e0dcdc3a-7b07-4387-a54e-73768de57432" width=600></p>

5. Для построения диаграмм связей только для пакетов, содержащих сообщения протокола HTTPS необходимо в поле фильтрации ввести следующее условие ```tcp.port==443```. Поскольку HTTPS работает поверх протокола TCP на порту 443, весь трафик будет отфильтрован по протоколу HTTPS.
Она представляет собой визуализацию взаимодействия между различными узлами в сети, участвующими в обмене данными по протоколу HTTPS (Клиенты и серверы, Установление Соединения, Обмен данными и Разрывы)

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/270fe297-60ab-4262-b781-f2bc33f4621f" width=600></p>

> Зеленый цвет обычно обозначает успешные пакеты, которые успешно прошли обработку.

> Синий может указывать на пакеты, связанные с тем, что они являются частью TCP-сессии, которая была открыта.

> Красные пакеты могут обозначать проблемные пакеты, такие как пакеты с ошибками чек-суммы или другими аномалиями.

> Желтый или оранжевый цвет может указывать на предупреждения или необычные события в сети.

> Серый цвет может использоваться для обозначения пакетов, которые были проигнорированы или не подходят под текущий фильтр.

> Фиолетовый цвет может использоваться для обозначения пакетов, связанных с протоколами управления сетевым соединением (например, протоколы управления передачей данных, как BGP).


* Фильтры, которые выделяют из общего числа пакеты  
1. Фильтры отбирающие сообщения протоколов HTTP, относящиеся только к взаимодействию локальных клиентов и внешнего сервера. То есть в случае, если на вашем компьютере запущен и Web-броузер и Web-сервер, фильтр должен отбирать только трафик от и к Web-браузеру, игнорируя трафик от и к Web-серверу.

Для того, чтобы отфильтровать HTTP трафик только для клиента, исключив пакеты к серверу, воспользуемся следующим фильтром:
```(tcp.dstport == 80 and ip.src == 192.168.3.58) or (tcp.srcport == 80 and ip.dst == 192.168.3.58)```  

В данном фильтре выбирается весь трафик, который либо отправляется хостом на внешний сервер на порт 80, либо отправляется внешним сервером с порта 80 на адрес хоста

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/48119dee-774f-4cab-9234-972bcdbd48c1" width=600></p>

2. Для фильтрации всех кадров Ethernet, отправленных с сетевого интерфейса хоста используем фильтр: ```eth.src==58:1c:f8:f0:4b:55``` Будут показаны только пакеты, отправляемые с сетевого интерфейса хоста.

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/14c74f4a-4048-422b-b6e1-b679f2887994" width=600></p>

3. Для того, чтобы отфильтровать только широковещательные сообщения используем фильтр: ```eth.dst==ff:ff:ff:ff:ff:ff``` Будут показаны только те пакеты, которые были отправлены на широковещательный адрес

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/4fe0b87d-b3f3-4752-960a-b5897b0d90ab" width=600></p>

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/4b6cdb24-6fbe-4c55-b76c-4aa778deb7d8" width=600></p>

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/883a34df-6138-4d70-837e-d72ec7f76c38" width=600></p>


Среди протоколов, есть только UDP, ARP и BROWSER. 

UDP  
Возможно, эти широковещательные пакеты относятся к какому-то IRC-трафику (Internet Relay Chat). Порт 6667 - это стандартный порт для IRC-серверов, и многие клиенты и серверы используют его для обмена сообщениями

ARP  
Кроме того, есть широковещательное сообщение ARP (Address Resolution Protocol) от устройства с MAC-адресом HuaweiDe_55:9c:6f. ARP-запросы используются для определения MAC-адреса, соответствующего определенному IP-адресу в локальной сети. В данном случае, запрос гласит: "Who has 192.168.3.5? Tell 192.168.3.1". Устройство с IP-адресом 192.168.3.1 запрашивает у сетевого устройства, имеющего IP-адрес 192.168.3.5, его MAC-адрес.

__Это может быть связано с процессом изучения коммутатором таблицы MAC-адресов.__

BROWSER
Обычно такие сообщения BROWSER используются для поиска ресурсов и служб в сети, и они могут быть отправлены различными устройствами в сети.
В данном случае, это BROWSER-сообщение содержит информацию о хосте с именем "LAPTOP-9K484JV5" и указывает на то, что этот хост представляет собой типы устройств "Workstation, Server, NT Workstation". Это анонсирование службы и информации о типах устройств может быть использовано для обнаружения других устройств в сети и определения их характеристик.

Примеры из предоставленных вами данных:

В строке с BROWSER-сообщением: 192.168.3.14 - это IP-адрес, куда направлено сообщение на сетевом уровне.  
```browser and ip.dst == 192.168.3.255```  


В строке с UDP-пакетами на порт 6667: 192.168.3.70 - это также IP-адрес, куда направлены пакеты на сетевом уровне.  
```ip.src == 192.168.3.70 && udp.dstport == 6667```  

В строке с ARP-запросом: 192.168.3.5 и 192.168.3.1 - это IP-адреса, связанные с ARP-запросом, который используется для определения MAC-адреса соответствующего IP-адреса на канальном уровне.  
```arp and ether host HuaweiDe_55:9c:6f```  

На основе предоставленных данных можно сказать, что устройство подключено к маршрутизатору


## <a name="section1.6">Сбор и анализ данных протокола ICMP</a>

1. Сбор и анализ данных протокола ICMP по локальным узлам.

Для отправки icmp запросов я использовал свой второй ноутбук с ip адресом 192.168.3.14, предварительно запустил новый сбор трафика и отфильтрвал его по icmp протоколу, после командой ping отправил 4 icmp запроса на свой основной ноутбук. Также для межсетевого экрана ```sudo ufw allow icmp```  

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/c6dd89ff-0a9b-4b79-95fe-e657885e9db6" width=600></p>  

Далее я стал получать трафик и увидел его в wireshark

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/a15112e2-6579-467d-a8b7-904315216a67" width=600></p>

Можно видеть ip адреса обоих устройств, а также получение и отправку icmp запроса (request, replay)


Для проверки mac адресов

* MAC адресс моего второго ноутбука

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/11cd7c11-b060-4007-907a-49900d534d4c" width=600></p>

* MAC адресс моего основного ноутбука

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/fc7e27b2-f26f-4af5-a8ad-5cd7e933243b" width=600></p>


Как можно видеть все сетевые настройки совпадают

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/2090e48e-8a89-4db5-af08-3ac4126253be" width=600></p>

Несмотря на то, что ICMP-запрос выполнялся по IP адресу, компьютеры смогли определить MAC-адреса друг друга. Это произошло с помощью протокола ARP, который позволяет устройствам узнать MAC-адрес получателя по IP-адресу.

2. Сбор и анализ данных протокола ICMP по удаленным узлам.

В качестве 3-ех зарубехных сми я выбрал bbc, cnn, nytimes

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/00f96519-f6bf-486e-befb-628b2e54be9d" width=600></p>

Как видно, удаленные узлы имеют следующие IP-адреса:
— bbc.com: 151.101.192.81;
— cnn.com: 151.101.3.5;
— nytimes.com: 151.101.65.164.

* Информация о ICMP-запросе на первый удаленный узел bbc.com

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/e1769fee-1590-48c3-9dba-e5520cbd036a" width=600></p>

* Информация о ICMP-запросе на второй удаленный узел nytimes.com

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/4c165404-8265-4cde-84b8-24056fe7f306" width=600></p>

* Информация о ICMP-запросе на третий удаленный узел cnn.com

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/900c3ae2-c7c2-44a0-b1c5-4aefdaf63132" width=600></p>

При этом MAC-адрес получателя всегда остается одним и тем же, несмотря на изменение адреса удаленного узла.

Wireshark показывает фактические MAC-адреса локальных узлов, так как они доступны в сетевом трафике, который проходит через локальные сетевые интерфейсы. Однако, когда речь идет о удаленных узлах, Wireshark может видеть только IP-адреса и MAC-адреса промежуточных маршрутизаторов. Поэтому все MAC-адреса получателя совпадают с MAC-адресом маршрутизатора

<p align=center><img src="https://github.com/DeFomin/2023-2024-computer-networks-k33212-fomintsev-d-r/assets/90705279/4d65d1f4-483d-4410-a8dc-78b95151cb06" width=600></p>

## <a name="section1.7">Анализ полей TCP</a>








